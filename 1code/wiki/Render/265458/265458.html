<div class="wikidoc"><h1>Invoke Native C++ DLL from .NET Code</h1><div style="text-align:right;float:right;">Writer: <a href="http://www.codeplex.com/site/users/view/Jialiang">Jialiang Ge</a></div><div style="clear:both;height:0;">&nbsp;</div> <br /><a href="http://1code.codeplex.com/wikipage?title=Invoke%20Native%20C%2b%2b%20DLL%20from%20.NET#PInvoke">Solution 1. (Explicit) P/Invoke</a><br /><a href="http://1code.codeplex.com/wikipage?title=Invoke%20Native%20C%2b%2b%20DLL%20from%20.NET#DynamicPInvoke">Solution 2. Dynamic P/Invoke</a><br /><a href="http://1code.codeplex.com/wikipage?title=Invoke%20Native%20C%2b%2b%20DLL%20from%20.NET#CLIWrapper">Solution 3. Implicit P/Invoke (Use a C++/CLI wrapper)</a><br /><a href="http://1code.codeplex.com/wikipage?title=Invoke%20Native%20C%2b%2b%20DLL%20from%20.NET#COMInterop">Solution 4. Convert C++ DLL to a COM server, and call it from .NET code through .NET-COM interop</a><br /> <br /><a name="PInvoke"></a>
<h2>Solution 1. (Explicit) P/Invoke</h2>Samples: 
<ul><li><b>CppDynamicLinkLibrary</b> (a native C++ DLL module that exports global data, functions and classes)</li>
<li><b>CSPInvokeDll</b> (a C# application that P/Invokes the functions exported by CppDynamicLinkLibrary)</li>
<li><b>VBPInvokeDll</b> (a VB.NET application that P/Invokes the functions exported by CppDynamicLinkLibrary)</li></ul>
Platform Invocation Services (P/Invoke) in .NET allows managed code to call unmanaged functions that are implemented and exported in unmanaged DLLs. The C# sample application CSPInvokeDll and the VB.NET sample application VBPInvokeDll demonstrate P/Invoking the functions exported by the native C++ DLL CppDynamicLinkLibrary.dll.<br /> <br /><a href="http&#58;&#47;&#47;1code.codeplex.com&#47;releases"><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=1code&DownloadId=120022" alt="Download" title="Download" /></a> Download the <a href="http://1code.codeplex.com/releases/view/44540#DownloadId=119923">All-In-One Code Framework (Library)</a> package.<br /> <br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=1code&DownloadId=120021" alt="PInvoke.png" title="PInvoke.png" /><br /><br /><a name="DynamicPInvoke"></a>
<h2>Solution 2. Dynamic P/Invoke</h2>Samples: 
<ul><li><b>CppDynamicLinkLibrary</b> (a native C++ DLL module that exports global data, functions and classes)</li>
<li><b>CSLoadLibrary</b> (a C# application that dynamically P/Invokes the functions exported by CppDynamicLinkLibrary)</li>
<li><b>VBLoadLibrary</b> (a VB.NET application that dynamically P/Invokes the functions exported by CppDynamicLinkLibrary)</li></ul>
Dynamic P/Invoke serves as a supplement for the P/Invoke technique and is useful especially when the target DLL is not in the search path of P/Invoke. If you use P/Invoke, CLR will search the dll in your assembly&#39;s directory first, then search the dll in directories listed in PATH environment variable. If the dll is not in any of those directories, you have to use the so called Dynamic P/Invoke technique. Dynamic P/Invoke dynamically loads the native DLL by calling LoadLibrary and gets the address of the target function through GetProcAddress and Marshal.GetDelegateForFunctionPointer. CSLoadLibrary and VBLoadLibrary use the technology to dynamically load and call CppDynamicLinkLibrary.<br /> <br /><a href="http&#58;&#47;&#47;1code.codeplex.com&#47;releases"><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=1code&DownloadId=120022" alt="Download" title="Download" /></a> Download the <a href="http://1code.codeplex.com/releases/view/44540#DownloadId=119923">All-In-One Code Framework (Library)</a> package.<br /> <br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=1code&DownloadId=120027" alt="DynamicPInvoke.png" title="DynamicPInvoke.png" /><br /><br /><a name="CLIWrapper"></a>
<h2>Solution 3. Implicit P/Invoke (Use a C++/CLI wrapper)</h2>Samples: 
<ul><li><b>CppDynamicLinkLibrary</b> (a native C++ DLL module that exports global data, functions and classes)</li>
<li><b>CppCLINativeDllWrapper</b> (a C++/CLI wrapper of the native C++ DLL CppDynamicLinkLibrary)</li>
<li><b>CSCallNativeDllWrapper</b> (a C# application that invokes CppDynamicLinkLibrary through CppCLINativeDllWrapper)</li>
<li><b>VBCallNativeDllWrapper</b> (a VB.NET application that invokes CppDynamicLinkLibrary through CppCLINativeDllWrapper)</li></ul>
The interoperability features supported by Visual C++/CLI offer a particular advantage over other .NET languages when it comes to interoperating with native modules. Apart from the traditional <a href="http://1code.codeplex.com/wikipage?title=Invoke%20Native%20C%2b%2b%20DLL%20from%20.NET#PInvoke">explicit P/Invoke</a>, C++/CLI allows implicit P/Invoke, also known as C++ Interop, or It Just Work (IJW), which mixes managed code and native code almost invisibly. The feature provides better type safety, easier coding, greater performance, and is more forgiving if the native API is modified. You can use the technology to build .NET wrappers for native C++ classes and functions if their source code is available, and allow any .NET clients to access the native C++ classes and functions through the wrappers. <br /> <br /><a href="http&#58;&#47;&#47;1code.codeplex.com&#47;releases"><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=1code&DownloadId=120022" alt="Download" title="Download" /></a> Download the <a href="http://1code.codeplex.com/releases/view/44540#DownloadId=119923">All-In-One Code Framework (Library)</a> package.<br /> <br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=1code&DownloadId=120031" alt="CLIWrapper.png" title="CLIWrapper.png" /><br /><br /><a name="COMInterop"></a>
<h2>Solution 4. Convert C++ DLL to a COM server, and call it from .NET code through .NET-COM interop</h2>Samples: 
<ul><li><b>ATLDllCOMServer</b> (a native C++ DLL converted to an in-process COM server)</li>
<li><b>CSCOMClient</b> (a C# application that invokes the C++ in-process COM server ATLDllCOMServer)</li>
<li><b>VBCOMClient</b> (a VB.NET application that invokes the C++ in-process COM server ATLDllCOMServer)</li></ul>
The .NET sample applications CSCOMClient and VBCOMClient invoke the in-process COM server ATLDllCOMServer that was converted from a native C++ DLL.<br /> <br /><a href="http&#58;&#47;&#47;1code.codeplex.com&#47;releases"><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=1code&DownloadId=120022" alt="Download" title="Download" /></a> Download the <a href="http://1code.codeplex.com/releases/view/44540#DownloadId=119919">All-In-One Code Framework (COM)</a> package.<br /> <br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=1code&DownloadId=120033" alt="COMInterop.png" title="COMInterop.png" /></div><div class="ClearBoth"></div>