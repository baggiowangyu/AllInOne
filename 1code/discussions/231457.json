[
  {
    "Id": "509280",
    "ThreadId": "231457",
    "Html": "<p>I know this example is not available (yet), so I went ahead and try to create it based on CSShellExtIInfotipHandler. My code looks like this:</p>\r\n<p>ShellExtLib.css</p>\r\n<div style=\"color:black;background-color:white\">\r\n<pre>    <span style=\"color:blue\">#region</span> Shell Interfaces\r\n\r\n    [StructLayout(LayoutKind.Sequential)]\r\n    <span style=\"color:blue\">public</span> <span style=\"color:blue\">struct</span> tagSIZE\r\n    {\r\n        <span style=\"color:blue\">public</span> Int64 cx;\r\n        <span style=\"color:blue\">public</span> Int64 cy;\r\n        <span style=\"color:blue\">public</span> tagSIZE(Int64 x, Int64 y)\r\n        {\r\n            cx = x;\r\n            cy = y;\r\n        }\r\n    }\r\n   \r\n    [ComImport(), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]\r\n    [Guid(<span style=\"color:#a31515\">&quot;12004DFB-E8B1-4D60-B093-78DBB479395B&quot;</span>)]\r\n    <span style=\"color:blue\">internal</span> <span style=\"color:blue\">interface</span> IExtractImage\r\n    {\r\n        <span style=\"color:blue\">void</span> Extract(System.IntPtr phBmpThumbnail);\r\n        <span style=\"color:blue\">void</span> GetLocation(<span style=\"color:blue\">string</span> pszPathBuffer, <span style=\"color:blue\">uint</span> cch, <span style=\"color:blue\">ref</span> <span style=\"color:blue\">uint</span> pdwPriority, <span style=\"color:blue\">ref</span> tagSIZE prgSize, <span style=\"color:blue\">uint</span> dwRecClrDepth, <span style=\"color:blue\">ref</span> <span style=\"color:blue\">uint</span> pdwFlags);\r\n    }\r\n\r\n    <span style=\"color:blue\">#endregion</span>\r\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p>FileIconExt.cs</p>\r\n<div style=\"color:black;background-color:white\">\r\n<pre>    [ClassInterface(ClassInterfaceType.None)]\r\n    [Guid(<span style=\"color:#a31515\">&quot;AE3993E5-D169-4426-A0B8-C55A01302619&quot;</span>), ComVisible(<span style=\"color:blue\">true</span>)]\r\n    <span style=\"color:blue\">public</span> <span style=\"color:blue\">class</span> FileIconExt : IPersistFile, IExtractImage\r\n    {\r\n        <span style=\"color:green\">// The name of the selected file.</span>\r\n        <span style=\"color:blue\">private</span> <span style=\"color:blue\">string</span> filename = <span style=\"color:blue\">null</span>;\r\n        tagSIZE _size;\r\n\r\n        <span style=\"color:blue\">#region</span> IExtractImage Members\r\n\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">void</span> Extract(System.IntPtr phBmpThumbnail)\r\n        {\r\n            Bitmap bmp = <span style=\"color:blue\">new</span> Bitmap(filename);\r\n            Bitmap bmpt = <span style=\"color:blue\">new</span> Bitmap((<span style=\"color:blue\">int</span>)_size.cx, (<span style=\"color:blue\">int</span>)_size.cy);\r\n            <span style=\"color:blue\">using</span> (Graphics g = Graphics.FromImage(bmpt))\r\n            {\r\n                g.DrawImage(bmp, 0, 0, _size.cx, _size.cy);\r\n            }\r\n            Marshal.WriteIntPtr(phBmpThumbnail, bmpt.GetHbitmap(Color.White));\r\n            bmp.Dispose();\r\n            bmpt.Dispose();\r\n        }\r\n\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">void</span> GetLocation(<span style=\"color:blue\">string</span> pszPathBuffer, <span style=\"color:blue\">uint</span> cch, <span style=\"color:blue\">ref</span> <span style=\"color:blue\">uint</span> pdwPriority, <span style=\"color:blue\">ref</span> tagSIZE prgSize, <span style=\"color:blue\">uint</span> dwRecClrDepth, <span style=\"color:blue\">ref</span> <span style=\"color:blue\">uint</span> pdwFlags)\r\n        {\r\n            _size = <span style=\"color:blue\">new</span> tagSIZE(prgSize.cx, prgSize.cy);\r\n            pdwPriority = 0x10000000u; <span style=\"color:green\">//normal priority</span>\r\n        }\r\n\r\n        <span style=\"color:blue\">#endregion</span>\r\n</pre>\r\n</div>\r\n<p>I didnt change the regions IPersistFile and Shell Extension Registration so I left those out. To test the extension I use a png image renamed to the extension &quot;.test1&quot;. I register this extension as following:</p>\r\n<p>&nbsp;</p>\r\n<pre>HKEY_CLASSES_ROOT\\.test1\\ShellEx\\{BB2E617C-0920-11d1-9A0B-00C04FC2D6C1}]\r\n@=&quot;{AE3993E5-D169-4426-A0B8-C55A01302619}&quot;\r\n\r\n[HKEY_CLASSES_ROOT\\CLSID\r\n@=&quot;{AE3993E5-D169-4426-A0B8-C55A01302619}&quot;\r\n\r\n[HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\CLSID\\{AE3993E5-D169-4426-A0B8-C55A01302619}]\r\n@=&quot;&quot;\r\n\r\n[HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\CLSID\\{AE3993E5-D169-4426-A0B8-C55A01302619}\\InprocServer32]\r\n@=&quot;D:\\\\Files\\\\Downloads\\\\Web\\\\ShellEx\\\\All-In-One Code Framework\\\\Visual Studio 2010\\\\CSShellExtIconHandler\\\\obj\\\\Debug\\\\CSShellExtIconHandler.dll&quot;\r\n&quot;Class&quot;=&quot;CSShellExtIconHandler.FileIconExt&quot;\r\n&quot;ThreadingModel&quot;=&quot;Apartment&quot;</pre>\r\n<p>Can anyone tell me what I am doing wrong? I suspect I am not creating the interface to IExtractImage correctly.</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2010-10-19T04:12:02.993-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "512212",
    "ThreadId": "231457",
    "Html": "\r\n<p>Hello</p>\r\n<p>I just finished a thumbnail handler code sample by implementing the IThumbnailProvider interface (instead of the old IExtractImage interface).&nbsp; Is your handler targeting Windows Vista and newer OS? If yes, the code sample may be helpful to you:</p>\r\n<p>CSShellExtThumbnailHandler: <a href=\"http://1code.codeplex.com/SourceControl/changeset/view/56349#1344566\">\r\nhttp://1code.codeplex.com/SourceControl/changeset/view/56349#1344566</a></p>\r\n<p>VBShellExtThumbnailHandler: <a href=\"http://1code.codeplex.com/SourceControl/changeset/view/56349#1345031\">\r\nhttp://1code.codeplex.com/SourceControl/changeset/view/56349#1345031</a></p>\r\n",
    "PostedDate": "2010-10-25T08:55:43.757-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "569478",
    "ThreadId": "231457",
    "Html": "<p>Sorry to ask in this old thread, but do you plan to implement thumbnail extension handler that Implements IExtractImage[2] interface?</p>",
    "PostedDate": "2011-02-21T00:52:05.46-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]