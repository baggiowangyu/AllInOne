[
  {
    "Id": "809019",
    "ThreadId": "348237",
    "Html": "<p>I would like to provide the user with the Cancel button - to abort a restore in progress. To do this, in the&nbsp;<code>Restore.PercentComplete</code>&nbsp;event handler I check if the user have clicked the Cancel button and call the&nbsp;<code>Restore.Abort()</code>.  But this does not help:</p>\n<p>The SMO throws exception:</p>\n<p>Restore failed for Server 'MICHAEL7'.&nbsp;An exception occurred while executing a Transact-SQL statement or batch.<br /> Stack Trace: &nbsp; at Microsoft.SqlServer.Management.Smo.Restore.SqlRestore(Server srv)</p>\n<p>The DB stays in the \"Restoring\" mode forever. Here is the relevant code:<span style=\"color: blue;\">&nbsp;</span></p>\n<div style=\"color: black; background-color: white;\">\n<pre><span style=\"color: blue;\"></span></pre>\n<div style=\"color: black; background-color: white;\">\n<pre><span style=\"color: blue;\">using</span> Microsoft.SqlServer.Management.Common;\n<span style=\"color: blue;\">using</span> Microsoft.SqlServer.Management.Smo;\n\n<span style=\"color: blue;\">private</span> <span style=\"color: blue;\">volatile</span> <span style=\"color: blue;\">bool</span> _CancelRestore = <span style=\"color: blue;\">false</span>;\n<span style=\"color: blue;\">private</span> Restore _RestoreDB;\n<span style=\"color: blue;\">private</span> Server _myServer;\n<span style=\"color: blue;\">private</span> Database _currentDatabase;\n\n<span style=\"color: green;\">// user hit Cancel buttton</span>\n<span style=\"color: blue;\">public</span> <span style=\"color: blue;\">void</span> CancelRestore()\n{\n    _CancelRestore = <span style=\"color: blue;\">true</span>;\n}\n\n<span style=\"color: green;\">// Restore.PercentComplete event handler</span>\n<span style=\"color: blue;\">private</span> <span style=\"color: blue;\">static</span> <span style=\"color: blue;\">void</span> CompletionStatusInPercent(<span style=\"color: blue;\">object</span> sender, PercentCompleteEventArgs args) \n{\n    <span style=\"color: blue;\">if</span> (_CancelRestore)\n    {\n        _RestoreDB.Abort();\n\n        <span style=\"color: green;\">// Disable the kills to let some time to Abort()</span>\n\n        <span style=\"color: green;\">// Stop all processes running on the _currentDatabase database</span>\n        <span style=\"color: green;\">// _myServer.KillAllProcesses(_currentDatabase.Name);</span>\n\n        <span style=\"color: green;\">// Stop the _currentDatabase database</span>\n        <span style=\"color: green;\">// NOTE: it is a temp name DB: I do not restore over my application DB!</span>\n        <span style=\"color: green;\">// _myServer.KillDatabase(_currentDatabase.Name);</span>\n    }\n    <span style=\"color: blue;\">else</span>\n    {\n        Console.Clear();\n        Console.WriteLine(<span style=\"color: #a31515;\">\"Percent completed: {0}%.\"</span>, args.Percent);\n    }\n}\n</pre>\n</div>\n<pre></pre>\n</div>\n<p>The Backup/Restore functionality was implemented with the help of this article:&nbsp;<a rel=\"nofollow\" href=\"http://www.codeproject.com/Articles/26390/SQL-Server-2005-Database-Backup-and-Restore-using\">SQL Server 2005 Database Backup and Restore using C# and  .NET 2.0</a></p>\n<p>Thanks.</p>",
    "PostedDate": "2012-03-12T04:19:01.72-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "811753",
    "ThreadId": "348237",
    "Html": "<p>I am using PhpMyadmin to do my database works :)</p>\r\n<p><a href=\"http://www.amazons-best.com\">Amazons Best Products</a> <a href=\"http://www.skynetforum.com\">Skynet Forum</a> <a href=\"http://www.cheapcarpets.org\">Cheap Carpets</a> <a href=\"http://www.cheapcarpets.org/Legato_Carpet_Tiles.html\">Legato Carpet Tiles</a> <a href=\"http://www.cheapcarpets.org/Carpet_Pricing.html\">Carpet Pricing</a> <a href=\"http://www.cheapcarpets.org/Carpet_Tiles_Cheap.html\">Carpet Tiles Cheap</a></p>",
    "PostedDate": "2012-03-16T23:54:16.22-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]